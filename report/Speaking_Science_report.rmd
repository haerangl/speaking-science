---
title: "Speaking Science"
subtitle: "W241 Final Project"
author: "Aris Fotkat≈æikis, Haerang Lee, Mumin Khan"
output:
  pdf_document: 
    toc: true
    toc_depth: 3
  github_document:
    toc: true
    toc_depth: 3
---

```{r, include=FALSE} 
# load packages 
library(data.table)
library(devtools)
library(dplyr)
library(foreign)
library(ggplot2)
library(gridExtra)
library(knitr)
library(lmtest)
library(Matching)
library(sandwich)
library(stargazer)
```

```{r, include=FALSE}
read_data <- function(data_file) {
  if(missing(data_file)) {
    data_file <- '../data/speaking_science_data_03-24_clean.csv'
  }
  
  d <- fread(data_file, )
  
  names = c('response_id', 'duration_in_seconds', 'time_read_article', 'credibility', 'importance', 'q1_correct', 'q2_correct', 'q3_correct', 'q4_correct', 'q5_correct', 'q6_correct', 'questions_correct', 'time_answering_questions', 'donation', 'treatment')

  d <- d[, names, with = FALSE]
  d <- na.omit(d)
  
  return(d)
}
```

A total of 264 people clicked on our survey on Mechanical Turk. 64 people did not complete the survey. Out of the 200 who completed the survey, we dropped 6 people, either due to missing values or because they stated that they were not LA residents. There were 40 people that their IP address placed outside CA and LA, but since they might have been people on travel we decided to keep them in our survey. We ended up having 97 people in treatment and 97 people in control. A graphical breakdown of ourparticipants is shown below.


```{r pressure, echo=FALSE, fig.cap="Sankey Diagram of survey data", out.width = '100%'}
knitr::include_graphics("Sankey_diagram.jpg")
```
Let's import the data for the 196 participants that comprise our treatment and control groups.


```{r}
d <- read_data("speaking_science_data_03-24_clean.csv")
summary(d)
```

We see that there are no missing values and nothing appears out of order. We examined many aspects of our data. In this EDA portion of our report, we will only highlight key aspects of our data, to adhere to the 20 page limitation. To ensure that we could use the quiz questions to assess how engaged our survey takers were, we selected relatively dificult questions. As we can see from the summary table above, nobody got all 6 questions correct. The distribution of the number of correct answers is shown below.This distribution is quite similar to the one we expected based on our pilot study (**WE NEED TO ADD GRAPHS OR REFER TO HAERANG'S SECTION HERE **)


```{r,  fig.width = 7, fig.height= 3.5}
# Average number of correct answers per group
d[d$treatment == 0][ , mean(questions_correct)]
d[d$treatment == 1][ , mean(questions_correct)]

ggplot(d, aes(x = questions_correct, fill = factor(treatment))) + 
  # geom_density(alpha = 0.4) +
  geom_histogram(position="dodge", breaks=c(-0.5, 0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5, 7.5))+
  geom_vline(aes(xintercept = mean(d[d$treatment == 0, questions_correct])), color = "darkgreen", linetype = "dashed", size = 1) + 
  geom_vline(aes(xintercept = mean(d[d$treatment == 1, questions_correct])), color = "black", linetype = "dashed", size = 1) +
  annotate("text", x = 2.3, y = 30, label = "Control mean: 2.36", color = "darkgreen", hjust="right") + 
  annotate("text", x = 2.8, y = 30, label = "Treatm.mean: 2.76", color = "black", hjust="left") + 
  ggtitle("Histogram of Quiz Scores") + geom_rug() + 
  ylab("Frequency") +
  xlab("Quiz Scores")+
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank())
```
We can see that Questions 4, 2, and 3 are the most difficult ones (in order of difficulty) and only 3 out of 6 questions had over 50% correct answers.

```{r}
# Most dificult question
cat("Number of correct answers for question Q_1, is: ", sum(d_1$Q_1), "\n")
cat("Number of correct answers for question Q_2, is: ", sum(d_1$Q_2),  "\n")
cat("Number of correct answers for question Q_3, is: ", sum(d_1$Q_3), "\n")
cat("Number of correct answers for question Q_4, is: ", sum(d_1$Q_4), "\n")
cat("Number of correct answers for question Q_5, is: ", sum(d_1$Q_5), "\n")
cat("Number of correct answers for question Q_6, is: ", sum(d_1$Q_6))

```

We also check the distribution of reading times for treatment and control. We can see in the graphs below that they don't follow a normal distribution. In addition, the actual distribution of donation amounts, seems to have a much smaller difference between treatment and control than either one of our assumed distributions, based on our pilot study (**WE NEED TO ADD GRAPHS OR REFER TO HAERANG'S SECTION HERE **). Our power analysis indicated that we needed more than 600 observations, but we only had 194. For an even smaller treatment effect, maybe we needed an even greater sample size. So we're not confident we will detect any treatment effects here. 

```{r}
ggplot(d, aes(x = time_read_article, fill = factor(treatment))) + 
  # geom_density(alpha = 0.4) +
  geom_histogram(position="dodge", binwidth=30)+
  geom_vline(aes(xintercept = mean(d[d$treatment == 0, time_read_article])), color = "darkgreen", linetype = "dashed", size = 1) + 
  geom_vline(aes(xintercept = mean(d[d$treatment == 1, time_read_article])), color = "black", linetype = "dashed", size = 1) +
  annotate("text", x = 180, y = 20, label = "Control mean: \n 185.0 s", color = "darkgreen", hjust="right") + 
  annotate("text", x = 200, y = 20, label = "Treat mean:\n 195.9", color = "black", hjust="left") + 
  ggtitle("Histogram of Reading Time") + geom_rug() + 
  ylab("Frequency") +
  xlab("Reading Time (s)")+
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank())
```

Let's check below the distribution of the survey duration and the distribution of the doonation with the quiz score (i.e. some of correct answers per survey taker). On the left we are showing the distribution of time spent reading the article with the number of correct answers. It is not surprising that in general the longer someone spent reading the article, the better they did on the quiz. This holds for treatment and control. The graph on the right, shows the distribution of the amount donated with the number of correct answers. It seems that the more correct answers a person had, the less amount of money they donated. This holds both for treatment and control. That might be an indication that the more effort people put in reading and answering the questions, the less they were inclined to donate their hard earned money.

```{r, fig.width = 10, fig.height= 3}
a <- ggplot(d, aes(x = as.factor(questions_correct), y = duration_in_seconds, color = factor(treatment) )) + geom_boxplot() + ylab("Duration (s)") +
  xlab("Quiz score")
b <- ggplot(d, aes(x = factor(questions_correct), y = donation, color = factor(treatment) )) + geom_boxplot() + ylab("Donation ($)") +
  xlab("Quiz score")

grid.arrange(a, b, ncol = 2)

```

We asked survey takers to rate the Importance of the topic discussed in the article and also rate their perceived Credibility of the article on a scale from 1 to 7. Plotting the distributions of the Importance and Credibility variables, we see on the right that the credibility ratings were rather similar for both treatment and control. On the left we see that the treatment group tends to assign higher Importance scores compared to control, and this difference is statistically significant at the 0.05 level, in accordance with our hypothesis.


```{r,fig.width = 10, fig.height= 3}
plot1 <- ggplot(d, aes(x = importance, fill = factor(treatment))) + 
  # geom_density(alpha = 0.4) +
  geom_histogram(position="dodge",breaks=c(-0.5, 0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5, 7.5))+
  ggtitle("Histogram of Perceived Importance Ratings") + geom_rug() + 
  ylab("Frequency") +
  xlab("Importance Rating")+
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank())

plot2 <- ggplot(d, aes(x = credibility, fill = factor(treatment))) + 
  # geom_density(alpha = 0.4) +
  geom_histogram(position="dodge",breaks=c(-0.5, 0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5, 7.5))+
  ggtitle("Histogram of Perceived Credibility Ratings") + geom_rug() + 
  ylab("Frequency") +
  xlab("Credibility Rating")+
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank())

grid.arrange(plot1, plot2, ncol = 2)
```

```{r}
# Test how different the distributions for treatment and control are for the Importance and Credibility ratings

wilcox.test(d$importance[d$treatment == 0], d$importance[d$treatment == 1])
wilcox.test(d$credibility[d$treatment == 0], d$credibility[d$treatment == 1])
```

